<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Gentallela Alela! | </title>

    <!-- Bootstrap -->
    <link href="/static/vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="/static/vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- Datatables -->
    <link href="/static/vendors/datatables.net-bs/css/jquery.dataTables.min.css" rel="stylesheet">
    <link href="/static/vendors/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet">
    <link href="/static/vendors/datatables.net-buttons-bs/css/buttons.bootstrap.min.css" rel="stylesheet">
    <link href="/static/vendors/datatables.net-fixedheader-bs/css/fixedHeader.bootstrap.min.css" rel="stylesheet">
    <link href="/static/vendors/datatables.net-responsive-bs/css/responsive.bootstrap.min.css" rel="stylesheet">
    <link href="/static/vendors/datatables.net-scroller-bs/css/scroller.bootstrap.min.css" rel="stylesheet">
    <!-- Custom Theme Style -->
    <link href="/static/css/custom.css" rel="stylesheet">

  </head>

       {% include 'gentelella/production/nav.html' %}

        <!-- page content -->
        <div class="right_col" role="main">
          <div class="">
            <div class="page-title">
              <div class="title_left">
                <h3>Plain Page</h3>
              </div>

              <div class="title_right">
                <div class="col-md-5 col-sm-5 col-xs-12 form-group pull-right top_search">
                  <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search for...">
                    <span class="input-group-btn">
                              <button class="btn btn-default" type="button">Go!</button>
                          </span>
                  </div>
                </div>
              </div>
            </div>
            <div class="clearfix"></div>

            <div class="row">

              <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel" style="height:1200px;">
                  <div class="x_title">
                    <h2>Plain Page</h2>
                    <ul class="nav navbar-right panel_toolbox">
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                      </li>
                      <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                        <ul class="dropdown-menu" role="menu">
                          <li><a href="#">Settings 1</a>
                          </li>
                          <li><a href="#">Settings 2</a>
                          </li>
                        </ul>
                      </li>
                      <li><a class="close-link"><i class="fa fa-close"></i></a>
                      </li>
                    </ul>
                    <div class="clearfix"></div>
                  </div>
                  <div class="x_content" style="display: block;">

                  <div class="" role="tabpanel" data-example-id="togglable-tabs">
                      <ul id="myTab" class="nav nav-tabs bar_tabs" role="tablist">
                          <li role="presentation" class="active"><a href="#tab_content1" id="home-tab" role="tab" data-toggle="tab" aria-expanded="true">{{ verbose_dic.主机名  }}主机信息</a>
                        </li>
                        <li role="presentation" class=""><a href="#tab_content2" role="tab" id="profile-tab" data-toggle="tab" aria-expanded="false">{{ verbose_dic.主机名  }}进程信息</a>
                        </li>
                        <li role="presentation" class=""><a href="#tab_content3" role="tab" id="profile-tab2" data-toggle="tab" aria-expanded="false">{{ verbose_dic.主机名   }}磁盘信息</a>
                        </li>
                      </ul>
                      <div id="myTabContent" class="tab-content">
                        <div role="tabpanel" class="tab-pane fade active in" id="tab_content1" aria-labelledby="home-tab">
                            <h2 id="uptxt"></h2>
                                {% for key,value in verbose_dic.items %}
                            <div class="row">
                                {% if forloop.counter = 1 %}
                            <div class="col-md-6">
                              <table class="table table-striped table-bordered">
                                <thead>
                                  <tr>
                                      <th class="column-title">属性 </th>
                                      <th class="column-title">值 </th>
                                </thead>
                                <tbody>
                                    {% elif forloop.counter = 13  %}
                                </tbody>
                                </table>
                            </div>
                            <div class="col-md-6">
                              <table class="table table-striped table-bordered">
                                <thead>
                                  <tr>
                                      <th class="column-title">属性 </th>
                                      <th class="column-title">值 </th>
                                </thead>
                                    {% endif  %}
                                  <tr>
                                      <td>{{ key }}</td>
                                      <td>{{ value }}</td>
                                  </tr>
                                {% endfor %}
                                  </tbody>
                                </table>
                                </div>
                                </div>
                        </div>
                        <div role="tabpanel" class="tab-pane fade" id="tab_content2" aria-labelledby="profile-tab">
                            <div class="spinner" >
                                  <div class="spinner-container container1">
                                      <div class="circle1"></div>
                                      <div class="circle2"></div>
                                      <div class="circle3"></div>
                                      <div class="circle4"></div>
                                  </div>
                                  <div class="spinner-container container2">
                                      <div class="circle1"></div>
                                      <div class="circle2"></div>
                                      <div class="circle3"></div>
                                      <div class="circle4"></div>
                                  </div>
                                  <div class="spinner-container container3">
                                      <div class="circle1"></div>
                                      <div class="circle2"></div>
                                      <div class="circle3"></div>
                                      <div class="circle4"></div>
                                  </div>
                            </div>
                            <table id="ps_tb" class="table table-striped table-bordered col-sm-12"></table>
                        </div>
                        <div role="tabpanel" class="tab-pane fade" id="tab_content3" aria-labelledby="profile-tab">
                            <table id="mt_tb" class="table table-striped table-bordered col-md-6"></table>
                        </div>
                      </div>
                    </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- /page content -->

        <!-- footer content -->
        <footer>
          <div class="pull-right">
            Gentelella - Bootstrap Admin Template by <a href="https://colorlib.com">Colorlib</a>
          </div>
          <div class="clearfix"></div>
        </footer>
        <!-- /footer content -->
      </div>
    </div>

    <!-- jQuery -->
    <script src="/static/vendors/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="/static/vendors/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="/static/vendors/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- FastClick -->
    <script src="/static/vendors/fastclick/lib/fastclick.js"></script>
    <!-- NProgress -->
    <script src="/static/vendors/nprogress/nprogress.js"></script>
    <script src="/static/vendors/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
    <script src="/static/vendors/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="/static/vendors/datatables.net-buttons/js/buttons.flash.min.js"></script>
    <script src="/static/vendors/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="/static/vendors/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="/static/vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js"></script>
    <script src="/static/vendors/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
    <script src="/static/vendors/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="/static/vendors/datatables.net-responsive-bs/js/responsive.bootstrap.js"></script>
    <script src="/static/vendors/datatables.net-scroller/js/dataTables.scroller.min.js"></script>


    <!-- Custom Theme Scripts -->
    <script src="/static/js/custom.js"></script>
    <script>
$(document).ready(function() {

    function percentNum(num,num2){
        return (Math.round(num / num2 * 10000) / 100.00 + "%");
    }
    function MtoG(num){
        return (Math.round(num / 1073741824.00));
    }
    var idc = {{ node_id }};
    var client = "local";
    var tgt_type = "glob";
    var tgt = "{{ verbose_dic.主机名 }}";
    var fun = "status.procs";
    var arg = "";
    $(".spinner").show();
    $.getJSON("/salt/result/", {idc:idc,client:client,tgt_type:tgt_type,tgt:tgt,fun:fun,arg:arg}, function(result) {
        //var t = JSON.stringify(result);
        var data = [];
        for( var key in result ){
            var ps = result[key];
        }
        for( var  key in ps ){
            var col = [];
            var p = key;
            var u = ps[key].user;
            var c = ps[key].cmd;
            p = JSON.stringify(p);
            u = JSON.stringify(u);
            c = JSON.stringify(c);
            col.push(p);
            col.push(u);
            col.push(c);
            data.push(col);
        }
        //alert(jQuery.type(data[0]));
        $('#ps_tb').DataTable( {
            data: data,
            pageLength: 20,
            columns: [
                { title: "Pid" },
                { title: "User" },
                { title: "Cmd" }
            ]
        } );
    });
        fun = "status.uptime";
        $.getJSON("/salt/result/", {idc:idc,client:client,tgt_type:tgt_type,tgt:tgt,fun:fun,arg:arg}, function(result) {
        for( var key in result ){
            var uptime = result[key];
        }
        var reboot_day = uptime.since_iso;
        var up_days = uptime.days;
        var up_d = JSON.stringify(up_days);
        var re_d = JSON.stringify(reboot_day).replace(/[A-Z]/gm, ' ');
        $("#uptxt").html("启动日期：<code>" + re_d + "</code> 启动天数：<code>" + up_d + "</code>");
        });
        fun = "status.diskusage";
        $.getJSON("/salt/result/", {idc:idc,client:client,tgt_type:tgt_type,tgt:tgt,fun:fun,arg:arg}, function(result) {
        data = [];
        for( var key in result ){
            var disk = result[key];
        }
        for ( var key in disk ){
        col = [];
        var mount_t = JSON.stringify(key);
        var useage_a = JSON.stringify(disk[key].available);
        var useage_t = JSON.stringify(disk[key].total);
        var per = percentNum(useage_a, useage_t);
        col.push(mount_t);
        col.push(per);
        col.push(MtoG(useage_t - useage_a));
        col.push(MtoG(useage_t));
        data.push(col);
        }
        $('#mt_tb').DataTable( {
            data: data,
            paging:false,
            searching:false,
            columns: [
                { title: "挂载点" },
                { title: "可用率 %" },
                { title: "已使用 GB" },
                { title: "总大小 GB" }
            ]
        } );
        });
        $(".spinner").hide();
});

    </script>

  </body>
</html>
